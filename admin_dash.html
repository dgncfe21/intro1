<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Field Job Tracker</title>

    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- DataTables CSS -->
    <link href="https://cdn.datatables.net/1.10.21/css/dataTables.bootstrap4.min.css" rel="stylesheet">
    
    <style>
        body {
            background-color: #2f2f2f;
            color: #ffffff;
        }

        .container-fluid {
            width: 100%;
            height: 100%;
            background-image: repeating-radial-gradient(#0c0a0a 80%, #2f312f 90%, #3f4549 90%);
            background-size: 65px 65px;
            padding: 40px;
        }

        .login-container {
            background-color: #2f2f2f;
            border-radius: 8px;
            padding: 40px;
            max-width: 1000px;
            margin: 0 auto;
            text-align: center;
        }

        .heading {
            color: #ffffff;
            font-weight: 500;
            font-size: 40px;
            margin-bottom: 5px;
        }

        .map-container {
            height: 500px;
            margin-bottom: 20px;
            background-color: #353535;
            border-radius: 8px;
        }

        @media (max-width: 768px) {
            .map-container {
                height: 300px;
            }
        }

        @media (max-width: 576px) {
            .map-container {
                height: 250px;
            }

            .blinking-icon {
        animation: blinkRed 1s infinite;
    }

    @keyframes blinkRed {
        0% {
            filter: hue-rotate(0deg);
        }
        50% {
            filter: hue-rotate(180deg); /* Apply red tint */
        }
        100% {
            filter: hue-rotate(0deg);
        }
    }
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="login-container">
            <h1 class="heading">Admin Reportes</h1>
            <div class="row">
                <div class="col-lg-12">
                    <div id="map" class="map-container"></div>
                </div>
            </div>
            <table id="circuitoTable" class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>Capacidad</th>
                        <th>Estatus</th>
                        <th>Lámpara</th>
                        <th>Latitud</th>
                        <th>Longitud</th>
                        <th>RPU</th>
                        <th>Trabajo</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <!-- Google Maps API -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCvhXkpjn3NIKaTnuL3X_W-IMty4urq2MA"></script>
    <!-- jQuery and DataTables -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.21/js/dataTables.bootstrap4.min.js"></script>

    <script>
        let map;
        const bucketMarkers = [];

        window.onload = function () {
            const firebaseConfig = {
               apiKey: "AIzaSyAmUH1B1JDgQMHsVML3Fd4unZ8fzAQuq7s",
  authDomain: "tsterapp-fcf1b.firebaseapp.com",
  databaseURL: "https://tsterapp-fcf1b-default-rtdb.firebaseio.com",
  projectId: "tsterapp-fcf1b",
  storageBucket: "tsterapp-fcf1b.firebasestorage.app",
  messagingSenderId: "27987269810",
  appId: "1:27987269810:web:5da5ddb5d3e526739751ab",
  measurementId: "G-XNS6DBLVEY"
            };

            firebase.initializeApp(firebaseConfig);
            const db = firebase.database();
            const table = $('#circuitoTable').DataTable();
            const infoWindow = new google.maps.InfoWindow();

            function initMap() {
                map = new google.maps.Map(document.getElementById('map'), {
                    center: { lat: 25.7683104, lng: -100.3140697 },
                    zoom: 12,
                    styles: [
            {
                "featureType": "water",
                "elementType": "geometry",
                "stylers": [
                    { "color": "#202c3e" }  // Dark gray-blue water
                ]
            },
            {
                "featureType": "landscape",
                "elementType": "geometry",
                "stylers": [
                    { "color": "#2f3948" }  // Dark gray for landscape
                ]
            },
            {
                "featureType": "road",
                "elementType": "geometry",
                "stylers": [
                    { "color": "#38414e" }  // Darker road colors
                ]
            },
            {
                "featureType": "poi",
                "elementType": "geometry",
                "stylers": [
                    { "color": "#283e4a" }  // Darker color for points of interest
                ]
            },
            {
                "elementType": "labels.text.fill",
                "stylers": [
                    { "color": "#ffffff" }  // White text for labels
                ]
            },
            {
                "elementType": "labels.text.stroke",
                "stylers": [
                    { "color": "#2f3948" }  // Darker text stroke
                ]
            }
        ]
                });
            }

      function populateTableAndMap() {
    const bucketRef = db.ref('CIRCUITO');

    bucketRef.on('value', (snapshot) => {
        const data = snapshot.val();
        table.clear();

        bucketMarkers.forEach(marker => marker.setMap(null));
        bucketMarkers.length = 0;

        for (const key in data) {
            const job = data[key];
            const {
                capacidad = "N/A",
                estatus = "N/A",
                lampara = "N/A",
                latitud = null,
                longitud = null,
                rpu = "N/A",
                trabajo = "N/A",
            } = job;

            table.row.add([
                capacidad,
                estatus,
                lampara,
                latitud || "Not available",
                longitud || "Not available",
                rpu,
                trabajo,
            ]);

            if (latitud && longitud) {
                // Icon logic
                const icon = trabajo !== "sr"
                    ? {
                        url: "work_r.png", // Static icon for "sr"
                        scaledSize: new google.maps.Size(32, 32),
                    }
                    : {
                        url: "lamp.png", // Static icon for "sr"
                        scaledSize: new google.maps.Size(32, 32),
                    };

                const marker = new google.maps.Marker({
                    position: { lat: parseFloat(latitud), lng: parseFloat(longitud) },
                    map: map,
                    title: `CIRCUITO - ${trabajo}`,
                    icon: icon,
                });

                // Add click listener for InfoWindow
                marker.addListener('click', () => {
                    const content = `
                        <div style="font-family: Arial, sans-serif; color: #333;">
                            <h4 style="margin: 0; padding: 0 0 5px; font-size: 16px; color: #007BFF;">Circuito Details</h4>
                            <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                                <tr>
                                    <td style="font-weight: bold; padding: 4px;">Capacidad:</td>
                                    <td style="padding: 4px;">${capacidad}</td>
                                </tr>
                                <tr>
                                    <td style="font-weight: bold; padding: 4px;">Estatus:</td>
                                    <td style="padding: 4px;">${estatus}</td>
                                </tr>
                                <tr>
                                    <td style="font-weight: bold; padding: 4px;">Lámpara:</td>
                                    <td style="padding: 4px;">${lampara}</td>
                                </tr>
                                <tr>
                                    <td style="font-weight: bold; padding: 4px;">Trabajo:</td>
                                    <td style="padding: 4px;">${trabajo}</td>
                                </tr>
                                <tr>
                                    <td style="font-weight: bold; padding: 4px;">RPU:</td>
                                    <td style="padding: 4px;">${rpu}</td>
                                </tr>
                            </table>
                        </div>
                    `;
                    infoWindow.setContent(content);
                    infoWindow.open(map, marker);
                });

                bucketMarkers.push(marker);
            }
        }

        table.draw();
    });
}





            initMap();
            populateTableAndMap();
        };
    </script>
</body>
</html>
